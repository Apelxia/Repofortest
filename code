  -- multiplexing process scan across anodes and digits
  mux_proc: process(clk)
  begin
    if rising_edge(clk) and clk_en='1' then
      -- Increment the digit index
      digit_index <= digit_index + 1;
      
      -- Reset digit index if it exceeds the maximum digit count
      if digit_index >= MAX_DIGITS then
        digit_index <= 0;
      end if;
      
      -- Set the anode signals
      for i in 0 to MAX_DIGITS-1 loop
        anodes_i(i) <= '1' when i = digit_index else '0';
      end loop;
      
      -- Set the digit signal to be displayed
      digit <= bcd(4*digit_index + 3 downto 4*digit_index);
      
      -- Enable decimal point if necessary
      dp <= dp_on(digit_index);
    end if;
  end process mux_proc;
  
end behavioral;
